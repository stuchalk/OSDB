(function(E,F,G,H,m,I,p,v,t,s,u,k,K,A,L,B,y,w,C,x,M,N,O,D,P,Q,R,z,S,T,U,V,W,X,Y,Z,$,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,f,j){p("JM");t(null,"JM.Text",["JU.PT","J.shape.Shape","JU.C","$.Font","JV.JC"],function(){var d=u(function(){this.vwr=null;this.doFormatText=!1;this.font=null;this.boxYoff2=this.offsetY=this.offsetX=this.lineHeight=this.descent=this.ascent=this.fid=0;this.widths=null;this.textHeight=this.textWidth=0;this.image=this.lines=this.textUnformatted=this.text=null;this.imageScale=
1;this.y0=this.yAdj=this.xAdj=this.barDistance=this.barPixels=0;this.pointerPt=null;this.isEcho=this.isMeasure=!1;this.script=this.target=this.xyz=null;this.atomY=this.atomX=this.valign=this.align=this.fontScale=this.pointer=this.bgcolix=this.colix=0;this.atomZ=2147483647;this.movableZ=this.movableY=this.movableX=0;this.movableZPercent=this.movableYPercent=this.movableXPercent=2147483647;this.z=1;this.zSlab=-2147483648;this.pymolOffset=null;this.windowHeight=this.windowWidth=0;this.adjustForWindow=
!1;this.boxY=this.boxX=this.boxHeight=this.boxWidth=0;this.modelIndex=-1;this.visible=!0;this.hidden=!1;this.boxXY=null;this.barPixelsXYZ=this.scalePixelsPerMicron=0;s(this,arguments)},JM,"Text",null);A(d,function(){this.boxXY=w(5,0)});d.newLabel=f(d,"newLabel",function(a,b,c,e,g,h,d){var f=new JM.Text;f.vwr=a;f.set(b,e,h,d);f.setText(c);f.bgcolix=g;return f},"JV.Viewer,JU.Font,~S,~N,~N,~N,~N");d.newMeasure=f(d,"newMeasure",function(a,b,c){var e=new JM.Text;e.vwr=a;e.set(b,c,0,0);e.isMeasure=!0;return e},
"JV.Viewer,JU.Font,~N");d.newEcho=f(d,"newEcho",function(a,b,c,e,g,h,d){var f=new JM.Text;f.isEcho=!0;f.vwr=a;f.set(b,e,h,d);f.target=c;f.valign=g;f.z=2;f.zSlab=-2147483648;return f},"JV.Viewer,JU.Font,~S,~N,~N,~N,~N");f(d,"set",function(a,b,c,e){this.scalePixelsPerMicron=e;this.colix=b;this.align=c;this.setFont(a,!this.isEcho)},"JU.Font,~N,~N,~N");f(d,"setOffset",function(a){this.offsetX=JV.JC.getXOffset(a);this.offsetY=JV.JC.getYOffset(a);this.pymolOffset=null;this.valign=3},"~N");f(d,"getFontMetrics",
function(){this.descent=this.font.getDescent();this.ascent=this.font.getAscent();this.lineHeight=this.ascent+this.descent});f(d,"setFontFromFid",function(a){this.fid!=a&&(this.fontScale=0,this.setFont(JU.Font.getFont3D(a),!0))},"~N");f(d,"setText",function(a){null!=this.image&&(this.getFontMetrics(),this.image=null);this.barPixels=0;null!=a&&0==a.length&&(a=null);null!=this.text&&this.text.equals(a)||(this.text=this.textUnformatted=a,(this.doFormatText=this.isEcho&&null!=a&&(0<=a.indexOf("%{")||0<=
a.indexOf("@{")))||this.recalc())},"~S");f(d,"setImage",function(a){this.image=a;this.recalc()},"~O");f(d,"setScale",function(a){this.imageScale=a;this.recalc()},"~N");f(d,"setFont",function(a,b){this.font=a;null!=this.font&&(this.getFontMetrics(),b&&(this.fid=this.font.fid,this.recalc()))},"JU.Font,~B");f(d,"setFontScale",function(a){this.fontScale!=a&&(this.fontScale=a,0!=this.fontScale&&null!=this.font&&this.setFont(this.vwr.gdata.getFont3DScaled(this.font,a),!0))},"~N");f(d,"recalc",function(){if(null!=
this.image)this.textWidth=this.textHeight=0,this.boxWidth=this.vwr.apiPlatform.getImageWidth(this.image)*this.fontScale*this.imageScale,this.boxHeight=this.vwr.apiPlatform.getImageHeight(this.image)*this.fontScale*this.imageScale,this.ascent=0;else if(null==this.text)this.widths=this.lines=this.text=null;else if(null!=this.font){this.lines=JU.PT.split(this.text,0<=this.text.indexOf("\n")?"\n":"|");this.textWidth=0;this.widths=y(this.lines.length,0);for(var a=this.lines.length;0<=--a;)this.textWidth=
Math.max(this.textWidth,this.widths[a]=this.stringWidth(this.lines[a]));this.textHeight=this.lines.length*this.lineHeight;this.boxWidth=this.textWidth+(2<=this.fontScale?16:8);this.boxHeight=this.textHeight+(2<=this.fontScale?16:8)}});f(d,"getPymolXYOffset",function(a,b,c){return(-1>a?-1:1<a?0:(a-1)/2)*b+(-1>a||1<a?a+(0>a?1:-1):0)*c},"~N,~N,~N");f(d,"setPosition",function(a,b,c,e){null==e?e=this.boxXY:this.boxXY=e;this.setWindow(this.vwr.gdata.width,this.vwr.gdata.height,a);0!=a&&0!=this.scalePixelsPerMicron?
this.setFontScale(a/this.scalePixelsPerMicron):this.fontScale!=b&&this.setFontScale(b);this.doFormatText?(this.text=this.isEcho?this.vwr.formatText(this.textUnformatted):this.textUnformatted,this.recalc()):null!=this.textUnformatted&&this.textUnformatted.startsWith("%SCALE")&&(a=w(2,0),this.text=this.vwr.getScaleText(this.textUnformatted.substring(6).trim(),this.vwr.antialiased,null==this.xyz?15:8,a),this.barPixels=k(a[0]*(this.vwr.antialiased?2:1)),this.barDistance=a[1],this.recalc());a=this.offsetX*
b;b*=this.offsetY;this.xAdj=2<=this.fontScale?8:4;this.yAdj=this.ascent-this.lineHeight+this.xAdj;if(!this.isEcho||null!=this.pymolOffset){e[0]=this.movableX;e[1]=this.movableY;null!=this.pymolOffset&&2!=this.pymolOffset[0]&&3!=this.pymolOffset[0]?(c=this.vwr.tm.scaleToScreen(this.z,1E3),a=this.pymolOffset[3],c*=(0>a?-1:1)*Math.max(0==a?0.5:0,Math.abs(a)-1),this.z-=k(c),c=this.vwr.tm.scaleToScreen(this.z,1E3),a=null!=this.xyz&&0<this.barPixels?0:this.getPymolXYOffset(this.pymolOffset[1],this.textWidth,
c),b=this.ascent-this.descent,b=-this.getPymolXYOffset(-this.pymolOffset[2],b,c)-m((this.textHeight+b)/2),1==this.pymolOffset[0]&&(b-=this.descent),this.xAdj=2<=this.fontScale?8:4,this.yAdj=-this.descent,e[0]=this.movableX-this.xAdj,e[1]=this.movableY-this.yAdj,c=!0,this.boxYoff2=-2):this.boxYoff2=0;if(null==this.pymolOffset)switch(this.align){case 8:a=b=0;break;case 12:e[0]-=this.boxWidth;case 4:b=0}JM.Text.setBoxXY(this.boxWidth,this.boxHeight,a,b,e,c)}else this.setPos(this.fontScale);this.boxX=
e[0];this.boxY=e[1];this.adjustForWindow&&this.setBoxOffsetsInWindow(0,this.isEcho?0:16*this.fontScale+this.lineHeight,this.boxY-this.textHeight);this.y0=this.boxY+this.yAdj;this.isMeasure&&8!=this.align&&(this.y0+=this.ascent+(this.lines.length-1)/2*this.lineHeight)},"~N,~N,~B,~A");f(d,"setPos",function(a){var b,c,e,g=null!=this.xyz;3==this.valign||4==this.valign?b=e=c=(2147483647!=this.movableXPercent?m(this.movableXPercent*this.windowWidth/100):g?this.movableX:this.movableX*a)+this.offsetX*a+this.barPixels:
(b=5*a,c=m((this.windowWidth+this.barPixels)/2),e=this.windowWidth-b,b+=this.barPixels);switch(this.align){case 8:this.boxXY[0]=c-this.boxWidth/2;break;case 12:this.boxXY[0]=e-this.boxWidth;break;default:this.boxXY[0]=b}this.boxXY[1]=0;switch(this.valign){case 0:break;case 2:this.boxXY[1]=m(this.windowHeight/2);break;case 1:this.boxXY[1]=this.windowHeight;break;default:b=2147483647!=this.movableYPercent?m(this.movableYPercent*this.windowHeight/100):g?this.movableY:this.movableY*a,this.boxXY[1]=(g?
b:this.windowHeight-b)+this.offsetY*a}8==this.align?this.boxXY[1]-=(null!=this.image?this.boxHeight:null!=this.xyz?this.boxHeight:this.ascent-this.boxHeight)/2:null!=this.image?this.boxXY[1]-=0:null!=this.xyz&&(this.boxXY[1]-=m(this.ascent/2))},"~N");d.setBoxXY=f(d,"setBoxXY",function(a,b,c,e,g,h){var d;0<c||h?d=c:(d=-a,d=0==c?d/2:d+c);g[0]+=d;g[1]+=h||0<e?-b-e:0==e?-b/2:-e;g[2]=a;g[3]=b},"~N,~N,~N,~N,~A,~B");f(d,"stringWidth",function(a){var b=0,c=1;if(null==a)return 0;if(0>a.indexOf("<su")&&0>a.indexOf("<color"))return this.font.stringWidth(a);
for(var e=a.length,g,h=0;h<e;h++){if("<"==a.charAt(h)){if(h+8<=e&&(a.substring(h,h+7).equals("<color ")||a.substring(h,h+8).equals("</color>"))){var d=a.indexOf(">",h);if(0<=d){h=d;continue}}if(h+5<=e&&((g=a.substring(h,h+5)).equals("<sub>")||g.equals("<sup>"))){h+=4;c=1;continue}if(h+6<=e&&((g=a.substring(h,h+6)).equals("</sub>")||g.equals("</sup>"))){h+=5;c=1;continue}}b+=this.font.stringWidth(a.substring(h,h+1))*c}return b},"~S");f(d,"setXYA",function(a,b){if(0==b){a[2]=this.boxX;switch(this.align){case 8:a[2]+=
this.boxWidth/2;break;case 12:a[2]+=this.boxWidth-this.xAdj;break;default:a[2]+=this.xAdj}a[0]=a[2];a[1]=this.y0}switch(this.align){case 8:a[0]=a[2]-m(this.widths[b]/2);break;case 12:a[0]=a[2]-this.widths[b]}a[1]+=this.lineHeight},"~A,~N");f(d,"appendFontCmd",function(a){a.append("  "+J.shape.Shape.getFontCommand("echo",this.font));0<this.scalePixelsPerMicron&&a.append(" "+1E4/this.scalePixelsPerMicron)},"JU.SB");f(d,"setScalePixelsPerMicron",function(a){this.fontScale=0;this.scalePixelsPerMicron=
a},"~N");f(d,"setXYZ",function(a,b){this.xyz=a;null==a&&(this.zSlab=-2147483648,this.pymolOffset=null);b&&(this.valign=null==a?3:4,this.adjustForWindow=null==a)},"JU.P3,~B");f(d,"setTranslucent",function(a,b){b?0!=this.bgcolix&&(this.bgcolix=JU.C.getColixTranslucent3(this.bgcolix,!Float.isNaN(a),a)):this.colix=JU.C.getColixTranslucent3(this.colix,!Float.isNaN(a),a)},"~N,~B");f(d,"setMovableX",function(a){this.valign=4==this.valign?4:3;this.movableX=a;this.movableXPercent=2147483647},"~N");f(d,"setMovableY",
function(a){this.valign=4==this.valign?4:3;this.movableY=a;this.movableYPercent=2147483647},"~N");f(d,"setMovableXPercent",function(a){this.valign=4==this.valign?4:3;this.movableX=2147483647;this.movableXPercent=a},"~N");f(d,"setMovableYPercent",function(a){this.valign=4==this.valign?4:3;this.movableY=2147483647;this.movableYPercent=a},"~N");f(d,"setMovableZPercent",function(a){4!=this.valign&&(this.valign=3);this.movableZ=2147483647;this.movableZPercent=a},"~N");f(d,"setZs",function(a,b){this.z=
a;this.zSlab=b},"~N,~N");f(d,"setXYZs",function(a,b,c,e){this.setMovableX(a);this.setMovableY(b);this.setZs(c,e)},"~N,~N,~N,~N");f(d,"setScript",function(a){this.script=null==a||0==a.length?null:a},"~S");f(d,"setAlignmentLCR",function(a){if(null!=a){if("left".equals(a))return this.setAlignment(4);if("center".equals(a))return this.setAlignment(8);if("right".equals(a))return this.setAlignment(12)}return!1},"~S");f(d,"setAlignment",function(a){this.align!=a&&(this.align=a,this.recalc());return!0},"~N");
f(d,"setBoxOffsetsInWindow",function(a,b,c){var e=this.boxWidth+a,g=this.boxX;g+e>this.windowWidth&&(g=this.windowWidth-e);g<a&&(g=a);this.boxX=g;a=this.boxHeight;c+a>this.windowHeight&&(c=this.windowHeight-a);c<b&&(c=b);this.boxY=c},"~N,~N,~N");f(d,"setWindow",function(a,b,c){this.windowWidth=a;this.windowHeight=b;null==this.pymolOffset&&(0>this.scalePixelsPerMicron&&0!=c)&&this.setScalePixelsPerMicron(c)},"~N,~N,~N");f(d,"checkObjectClicked",function(a,b,c,e){if(this.hidden||null==this.script||
0<=this.modelIndex&&!e.get(this.modelIndex))return!1;a&&(b<<=1,c<<=1);return b>=this.boxX&&b<=this.boxX+this.boxWidth&&c>=this.boxY&&c<=this.boxY+this.boxHeight},"~B,~N,~N,JU.BS");f(d,"getPymolScreenOffset",function(a,b,c,e,g){var h=this.pymolOffset[0];null!=a&&1==Math.abs(h)%2?e.setT(a):e.set(0,0,0);e.add3(this.pymolOffset[4],this.pymolOffset[5],this.pymolOffset[6]);this.vwr.tm.transformPtScr(e,b);if(2==h||3==h)b.x+=this.pymolOffset[1],b.y+=this.pymolOffset[2],b.z+=this.pymolOffset[3];this.setXYZs(b.x,
b.y,b.z,c);this.setScalePixelsPerMicron(g)},"JU.P3,JU.P3i,~N,JU.P3,~N");j(d,"toString",function(){return this.textUnformatted})});p("J.shape");t(["J.shape.Shape","java.util.Hashtable"],"J.shape.TextShape",["JU.P3","$.PT","JU.C","$.Logger"],function(){var d=u(function(){this.currentBgColor=this.currentColor=this.currentFont=this.currentObject=this.objects=null;this.currentBgTranslucentLevel=this.currentTranslucentLevel=0;this.thisID=null;this.isAll=this.isHover=!1;s(this,arguments)},J.shape,"TextShape",
J.shape.Shape);x(d,function(){this.objects=new java.util.Hashtable});f(d,"setPropTS",function(a,b,c){if("text"===a)if(a=b,null!=this.currentObject)this.currentObject.setText(a);else{if(this.isAll){var e;for(c=this.objects.values().iterator();c.hasNext()&&((e=c.next())||1);)e.setText(a)}}else if("font"===a)if(this.currentFont=b,null!=this.currentObject)this.currentObject.setFont(this.currentFont,!0),this.currentObject.setFontScale(0);else{if(this.isAll)for(c=this.objects.values().iterator();c.hasNext()&&
((e=c.next())||1);)e.setFont(this.currentFont,!0)}else if("allOff"===a)this.currentObject=null,this.isAll=!0,this.objects=new java.util.Hashtable;else if("delete"===a)if(v(b,"JM.Text")&&(this.currentObject=b),null!=this.currentObject)this.objects.remove(this.currentObject.target),this.currentObject=null;else{if(this.isAll||null!=this.thisID)for(c=this.objects.values().iterator();c.hasNext();)a=c.next(),(this.isAll||JU.PT.isMatch(a.target.toUpperCase(),this.thisID,!0,!0))&&c.remove()}else if("off"===
a)this.isAll&&(this.objects=new java.util.Hashtable,this.isAll=!1,this.currentObject=null),null!=this.currentObject&&(this.objects.remove(this.currentObject.target),this.currentObject=null);else if("model"===a)if(b=b.intValue(),null!=this.currentObject)this.currentObject.modelIndex=b;else{if(this.isAll)for(c=this.objects.values().iterator();c.hasNext()&&((e=c.next())||1);)e.modelIndex=b}else if("align"===a)if(null!=this.currentObject)this.currentObject.setAlignmentLCR(b)||JU.Logger.error("unrecognized align:"+
b);else{if(this.isAll){var g;for(e=this.objects.values().iterator();e.hasNext()&&((g=e.next())||1);)g.setAlignmentLCR(b)}}else if("bgcolor"===a)if(this.currentBgColor=b,null!=this.currentObject)this.currentObject.bgcolix=JU.C.getColixO(b);else{if(this.isAll)for(c=this.objects.values().iterator();c.hasNext();)c.next().bgcolix=JU.C.getColixO(b)}else if("color"===a)if(this.currentColor=b,null!=this.currentObject)this.currentObject.colix=JU.C.getColixO(b);else{if(this.isAll||null!=this.thisID)for(c=this.objects.values().iterator();c.hasNext();)if(a=
c.next(),this.isAll||JU.PT.isMatch(a.target.toUpperCase(),this.thisID,!0,!0))a.colix=JU.C.getColixO(b)}else if("target"===a){if((this.isAll=b.equals("all"))||b.equals("none"))this.currentObject=null}else if((e="bgtranslucency"===a)||"translucency"===a)if(b="translucent"===b,e?this.currentBgTranslucentLevel=b?this.translucentLevel:0:this.currentTranslucentLevel=b?this.translucentLevel:0,null!=this.currentObject)this.currentObject.setTranslucent(this.translucentLevel,e);else{if(this.isAll)for(c=this.objects.values().iterator();c.hasNext();)c.next().setTranslucent(this.translucentLevel,
e)}else if("deleteModelAtoms"===a){b=b[2][0];for(c=this.objects.values().iterator();c.hasNext();)a=c.next(),a.modelIndex==b?c.remove():a.modelIndex>b&&a.modelIndex--}else this.setPropS(a,b,c)},"~S,~O,JU.BS");j(d,"getShapeState",function(){return null});j(d,"initModelSet",function(){this.currentObject=null;this.isAll=!1});j(d,"setModelVisibilityFlags",function(a){if(!this.isHover)for(var b,c=this.objects.values().iterator();c.hasNext()&&((b=c.next())||1);)b.visible=0>b.modelIndex||a.get(b.modelIndex)},
"JU.BS");j(d,"checkObjectClicked",function(a,b,c,e){if(this.isHover||0==c)return null;c=this.vwr.antialiased;for(var g,h=this.objects.values().iterator();h.hasNext()&&((g=h.next())||1);)if(g.checkObjectClicked(c,a,b,e))return null!=g.script&&this.vwr.evalStringQuiet(g.script),a=new java.util.Hashtable,a.put("pt",null==g.xyz?new JU.P3:g.xyz),b=g.modelIndex,0>b&&(b=0),a.put("modelIndex",Integer.$valueOf(b)),a.put("model",this.vwr.getModelNumberDotted(b)),a.put("id",g.target),a.put("type","echo"),a;
return null},"~N,~N,~N,JU.BS,~B");j(d,"checkObjectHovered",function(a,b,c){if(this.isHover)return!1;for(var e=!1,g=this.vwr.antialiased,h,d=this.objects.values().iterator();d.hasNext()&&((h=d.next())||1);)if(null!=h.script&&(e=!0,h.checkObjectClicked(g,a,b,c)))return this.vwr.setCursor(12),!0;e&&this.vwr.setCursor(0);return!1},"~N,~N,JU.BS")});p("J.shape");t(["J.shape.AtomShape","java.util.Hashtable","JU.P3"],"J.shape.Labels","JU.AU $.BS $.PT J.c.PAL JM.LabelToken $.Text JS.SV JU.BSUtil $.C $.Font JV.JC".split(" "),
function(){var d=u(function(){this.bsBgColixSet=this.bsFontSet=this.labelBoxes=this.atomLabels=this.offsets=this.fids=this.bgcolixes=this.formats=this.strings=null;this.zeroFontId=this.defaultPointer=this.defaultPaletteID=this.defaultBgcolix=this.defaultColix=this.defaultFontId=this.defaultZPos=this.defaultAlignment=this.defaultOffset=0;this.isScaled=this.setDefaults=!1;this.scalePixelsPerMicron=0;this.ptTemp=null;this.lastPicked=this.pickedAtom=-1;this.pickedY=this.pickedX=this.pickedOffset=0;s(this,
arguments)},J.shape,"Labels",J.shape.AtomShape);x(d,function(){this.atomLabels=new java.util.Hashtable;this.ptTemp=new JU.P3});j(d,"initShape",function(){this.defaultFontId=this.zeroFontId=this.vwr.gdata.getFont3DFSS("SansSerif","Plain",13).fid;this.defaultBgcolix=this.defaultColix=0;this.defaultOffset=JV.JC.LABEL_DEFAULT_OFFSET;this.defaultAlignment=4;this.defaultZPos=this.defaultPointer=0;this.translucentAllowed=!1});j(d,"setProperty",function(a,b,c){this.isActive=!0;var e=this.ms.at,g=this.ms.ac;
if("setDefaults"===a)this.setDefaults=b.booleanValue();else if("color"===a){var h=J.c.PAL.pidOf(b),e=JU.C.getColixO(b);if(this.setDefaults)this.defaultColix=e,this.defaultPaletteID=h;else{g=this.checkColixLength(e,c.length());for(a=c.nextSetBit(0);0<=a&&a<g;a=c.nextSetBit(a+1))this.setLabelColix(a,e,h)}}else if("scalereference"===a){if(null!=this.strings){a=b.floatValue();h=0==a?0:1E4/a;g=Math.min(g,this.strings.length);for(a=c.nextSetBit(0);0<=a&&a<g;a=c.nextSetBit(a+1))e=this.getLabel(a),null==
e?(e=JM.Text.newLabel(this.vwr,null,this.strings[a],0,0,0,h),this.putLabel(a,e)):e.setScalePixelsPerMicron(h)}}else if("label"===a){e=this.isPickingMode()&&1==c.cardinality()&&c.nextSetBit(0)==this.lastPicked;this.setScaling();var h=null,d=this.checkStringLength(c.length());(0!=this.defaultColix||0!=this.defaultPaletteID)&&this.checkColixLength(this.defaultColix,c.length());0!=this.defaultBgcolix&&this.checkBgColixLength(this.defaultBgcolix,c.length());if(v(b,"JU.Lst")){var g=b.size(),h=z(-1,[null]),
f=0;for(a=c.nextSetBit(0);0<=a&&a<d;a=c.nextSetBit(a+1))f>=g?this.setLabel(J.shape.Labels.nullToken,"",a,!e):(h[0]=null,this.setLabel(h,JS.SV.sValue(b.get(f++)),a,!e))}else{h=null==b||0==b.length?J.shape.Labels.nullToken:z(-1,[null]);for(a=c.nextSetBit(0);0<=a&&a<g;a=c.nextSetBit(a+1))this.setLabel(h,b,a,!e)}}else if(a.startsWith("label:"))this.setScaling(),this.checkStringLength(g),c=a.substring(6),0==c.length&&(c=null),this.setLabel(z(-1,[null]),c,b.intValue(),!1);else if("clearBoxes"===a)this.labelBoxes=
null;else if(!("translucency"===a||"bgtranslucency"===a))if("bgcolor"===a)if(this.isActive=!0,null==this.bsBgColixSet&&(this.bsBgColixSet=JU.BS.newN(g)),h=JU.C.getColixO(b),this.setDefaults)this.defaultBgcolix=h;else{g=this.checkBgColixLength(h,c.length());for(a=c.nextSetBit(0);0<=a&&a<g;a=c.nextSetBit(a+1))this.setBgcolix(a,h)}else if(null==this.bsFontSet&&(this.bsFontSet=JU.BS.newN(g)),"fontsize"===a)if(h=b.intValue(),0>h)this.fids=null;else if(this.setDefaults)e=JU.Font.getFont3D(this.defaultFontId),
this.defaultFontId=this.vwr.getFont3D(e.fontFace,e.fontStyle,h).fid;else for(a=c.nextSetBit(0);0<=a&&a<g;a=c.nextSetBit(a+1))e=JU.Font.getFont3D(null==this.fids||a>=this.fids.length?this.fids[a]:this.defaultFontId),this.setFont(a,this.vwr.getFont3D(e.fontFace,e.fontStyle,h).fid);else if("font"===a)if(h=b.fid,this.setDefaults)this.defaultFontId=h;else for(a=c.nextSetBit(0);0<=a&&a<g;a=c.nextSetBit(a+1))this.setFont(a,h);else if("offset"===a)if(v(b,Integer))if(h=b.intValue(),this.setDefaults)this.defaultOffset=
h;else for(a=c.nextSetBit(0);0<=a&&a<g;a=c.nextSetBit(a+1))this.setOffsets(a,h);else{if(!this.setDefaults){this.checkColixLength(-1,g);for(a=c.nextSetBit(0);0<=a&&a<g;a=c.nextSetBit(a+1))this.setPymolOffset(a,b)}}else if("align"===a)if(h=b.equalsIgnoreCase("right")?12:b.equalsIgnoreCase("center")?8:4,this.setDefaults)this.defaultAlignment=h;else for(a=c.nextSetBit(0);0<=a&&a<g;a=c.nextSetBit(a+1))this.setHorizAlignment(a,h);else if("pointer"===a)if(h=b.intValue(),this.setDefaults)this.defaultPointer=
h;else for(a=c.nextSetBit(0);0<=a&&a<g;a=c.nextSetBit(a+1))this.setPointer(a,h);else if("front"===a)if(h=b.booleanValue(),this.setDefaults)this.defaultZPos=h?32:0;else for(a=c.nextSetBit(0);0<=a&&a<g;a=c.nextSetBit(a+1))this.setZPos(a,32,h);else if("group"===a)if(h=b.booleanValue(),this.setDefaults)this.defaultZPos=h?16:0;else for(a=c.nextSetBit(0);0<=a&&a<g;a=c.nextSetBit(a+1))this.setZPos(a,16,h);else if("display"===a||"toggleLabel"===a){d="toggleLabel"===a?0:b.booleanValue()?1:-1;null==this.mads&&
(this.mads=D(g,0));var n=f=null,l=null,k=null,r=this.checkStringLength(c.length()),h=this.defaultBgcolix,m=this.checkBgColixLength(h,c.length()),j=0<=d?1:-1;for(a=c.nextSetBit(0);0<=a&&a<g;a=c.nextSetBit(a+1)){var p=e[a];a<r&&null!=this.strings[a]?this.mads[a]=1==d||0==d&&0>this.mads[a]?1:-1:(this.mads[a]=j,p.getGroup3(!1).equals("UNK")?(null==l&&(l=this.vwr.getStandardLabelFormat(1),k=JM.LabelToken.compile(this.vwr,l,"\x00",null)),b=l,h=k):(null==f&&(f=this.vwr.getStandardLabelFormat(2),n=JM.LabelToken.compile(this.vwr,
f,"\x00",null)),b=f,h=n),this.strings[a]=JM.LabelToken.formatLabelAtomArray(this.vwr,p,h,"\x00",null,this.ptTemp),this.formats[a]=b,this.bsSizeSet.set(a),a<m&&!this.bsBgColixSet.get(a)&&this.setBgcolix(a,this.defaultBgcolix));p.setShapeVisibility(this.vf,null!=this.strings&&a<this.strings.length&&null!=this.strings[a]&&0<=this.mads[a])}}else"pymolLabels"===a?this.setPymolLabels(b,c):("deleteModelAtoms"===a&&(this.labelBoxes=null,g=b[2][1],h=b[2][2],this.fids=JU.AU.deleteElements(this.fids,g,h),this.bgcolixes=
JU.AU.deleteElements(this.bgcolixes,g,h),this.offsets=JU.AU.deleteElements(this.offsets,g,h),this.formats=JU.AU.deleteElements(this.formats,g,h),this.strings=JU.AU.deleteElements(this.strings,g,h),JU.BSUtil.deleteBits(this.bsFontSet,c),JU.BSUtil.deleteBits(this.bsBgColixSet,c)),this.setPropAS(a,b,c))},"~S,~O,JU.BS");f(d,"isPickingMode",function(){return 2==this.vwr.getPickingMode()&&null!=this.labelBoxes});f(d,"checkStringLength",function(a){a=Math.min(this.ms.ac,a);if(null==this.strings||a>this.strings.length)this.formats=
JU.AU.ensureLengthS(this.formats,a),this.strings=JU.AU.ensureLengthS(this.strings,a),null==this.bsSizeSet&&(this.bsSizeSet=JU.BS.newN(a));return a},"~N");f(d,"checkBgColixLength",function(a,b){b=Math.min(this.ms.ac,b);if(0==a)return null==this.bgcolixes?0:this.bgcolixes.length;if(null==this.bgcolixes||b>this.bgcolixes.length)this.bgcolixes=JU.AU.ensureLengthShort(this.bgcolixes,b);return b},"~N,~N");f(d,"setPymolLabels",function(a,b){this.setScaling();var c=this.checkStringLength(this.ms.ac);this.checkColixLength(-1,
c);for(var e=b.nextSetBit(0);0<=e&&e<c;e=b.nextSetBit(e+1))this.setPymolLabel(e,a.get(Integer.$valueOf(e)),null)},"java.util.Map,JU.BS");f(d,"setPymolOffset",function(a,b){var c=this.getLabel(a);if(null==c){if(null==this.strings||a>=this.strings.length||null==this.strings[a])return;c=null!=this.bsFontSet&&this.bsFontSet.get(a)?this.fids[a]:-1;0>c&&this.setFont(a,c=this.defaultFontId);var e=this.ms.at[a],c=JM.Text.newLabel(this.vwr,JU.Font.getFont3D(c),this.strings[a],this.getColix2(a,e,!1),this.getColix2(a,
e,!0),0,this.scalePixelsPerMicron);this.setPymolLabel(a,c,this.formats[a])}c.pymolOffset=b},"~N,~A");f(d,"setScaling",function(){this.isActive=!0;null==this.bsSizeSet&&(this.bsSizeSet=JU.BS.newN(this.ms.ac));this.scalePixelsPerMicron=(this.isScaled=this.vwr.getBoolean(603979845))?1E4*this.vwr.getScalePixelsPerAngstrom(!1):0});f(d,"setPymolLabel",function(a,b,c){if(null!=b){var e=b.text,g=this.ms.at[a];null!=g&&(this.addString(g,a,e,null==c?JU.PT.rep(e,"%","%%"):c),g.setShapeVisibility(this.vf,!0),
0<=b.colix&&this.setLabelColix(a,b.colix,J.c.PAL.UNKNOWN.id),this.setFont(a,b.font.fid),this.putLabel(a,b))}},"~N,JM.Text,~S");f(d,"setLabel",function(a,b,c,e){var g=this.ms.at[c],h=a[0];null==h&&(h=a[0]=JM.LabelToken.compile(this.vwr,b,"\x00",null));a=null==h?null:JM.LabelToken.formatLabelAtomArray(this.vwr,g,h,"\x00",null,this.ptTemp);g=this.addString(g,c,a,b);e=(new Boolean(e|(g||null==a))).valueOf();g=this.getLabel(c);this.isScaled&&e?(g=JM.Text.newLabel(this.vwr,null,a,0,0,0,this.scalePixelsPerMicron),
this.putLabel(c,g)):null!=g&&(null==a?this.putLabel(c,null):(g.setText(a),g.textUnformatted=b));e&&(this.defaultOffset!=JV.JC.LABEL_DEFAULT_OFFSET&&this.setOffsets(c,this.defaultOffset),4!=this.defaultAlignment&&this.setHorizAlignment(c,this.defaultAlignment),0!=(this.defaultZPos&32)?this.setZPos(c,32,!0):0!=(this.defaultZPos&16)&&this.setZPos(c,16,!0),0!=this.defaultPointer&&this.setPointer(c,this.defaultPointer),(0!=this.defaultColix||0!=this.defaultPaletteID)&&this.setLabelColix(c,this.defaultColix,
this.defaultPaletteID),0!=this.defaultBgcolix&&this.setBgcolix(c,this.defaultBgcolix),this.defaultFontId!=this.zeroFontId&&this.setFont(c,this.defaultFontId))},"~A,~S,~N,~B");f(d,"addString",function(a,b,c,e){a.setShapeVisibility(this.vf,null!=c);a=null!=e;var g=null==this.strings[b];this.strings[b]=c;this.formats[b]=a&&0<=e.indexOf("%{")?c:e;this.bsSizeSet.setBitTo(b,a);return g},"JM.Atom,~N,~S,~S");j(d,"getProperty",function(a,b){return a.equals("font")?JU.Font.getFont3D(this.defaultFontId):a.equals("offsets")?
this.offsets:a.equals("label")?null!=this.strings&&b<this.strings.length&&null!=this.strings[b]?this.strings[b]:"":null},"~S,~N");f(d,"putLabel",function(a,b){null==b?this.atomLabels.remove(Integer.$valueOf(a)):(this.atomLabels.put(Integer.$valueOf(a),b),b.textUnformatted=this.formats[a])},"~N,JM.Text");f(d,"getLabel",function(a){return this.atomLabels.get(Integer.$valueOf(a))},"~N");f(d,"putBox",function(a,b){null==this.labelBoxes&&(this.labelBoxes=new java.util.Hashtable);this.labelBoxes.put(Integer.$valueOf(a),
b)},"~N,~A");f(d,"getBox",function(a){return null==this.labelBoxes?null:this.labelBoxes.get(Integer.$valueOf(a))},"~N");f(d,"setLabelColix",function(a,b,c){this.setColixAndPalette(b,c,a);var e;if(null!=this.colixes&&null!=(e=this.getLabel(a)))e.colix=this.colixes[a]},"~N,~N,~N");f(d,"setBgcolix",function(a,b){this.bgcolixes[a]=b;this.bsBgColixSet.setBitTo(a,0!=b);var c=this.getLabel(a);null!=c&&(c.bgcolix=b)},"~N,~N");f(d,"setOffsets",function(a,b){if(null==this.offsets||a>=this.offsets.length){if(b==
JV.JC.LABEL_DEFAULT_OFFSET)return;this.offsets=JU.AU.ensureLengthI(this.offsets,this.ms.ac)}this.offsets[a]=this.offsets[a]&63|b;var c=this.getLabel(a);null!=c&&c.setOffset(b)},"~N,~N");f(d,"setHorizAlignment",function(a,b){if(null==this.offsets||a>=this.offsets.length){switch(b){case 0:case 4:return}this.offsets=JU.AU.ensureLengthI(this.offsets,this.ms.ac)}0==b&&(b=4);this.offsets[a]=JV.JC.setHorizAlignment(this.offsets[a],b);var c=this.getLabel(a);null!=c&&c.setAlignment(b)},"~N,~N");f(d,"setPointer",
function(a,b){if(null==this.offsets||a>=this.offsets.length){if(0==b)return;this.offsets=JU.AU.ensureLengthI(this.offsets,this.ms.ac)}this.offsets[a]=JV.JC.setPointer(this.offsets[a],b);var c=this.getLabel(a);null!=c&&(c.pointer=b)},"~N,~N");f(d,"setZPos",function(a,b,c){if(null==this.offsets||a>=this.offsets.length){if(!c)return;this.offsets=JU.AU.ensureLengthI(this.offsets,this.ms.ac)}this.offsets[a]=JV.JC.setZPosition(this.offsets[a],c?b:0)},"~N,~N,~B");f(d,"setFont",function(a,b){if(null==this.fids||
a>=this.fids.length){if(b==this.zeroFontId)return;this.fids=JU.AU.ensureLengthI(this.fids,this.ms.ac)}this.fids[a]=b;this.bsFontSet.set(a);var c=this.getLabel(a);null!=c&&c.setFontFromFid(b)},"~N,~N");j(d,"setAtomClickability",function(){if(null!=this.strings)for(var a=this.strings.length;0<=--a;)null!=this.strings[a]&&(this.ms.at.length>a&&null!=this.ms.at[a]&&!this.ms.isAtomHidden(a))&&this.ms.at[a].setClickable(this.vf)});j(d,"checkObjectClicked",function(a,b){if(!this.isPickingMode())return null;
var c=this.findNearestLabel(a,b);if(0>c)return null;var e=new java.util.Hashtable;e.put("type","label");e.put("atomIndex",Integer.$valueOf(c));this.lastPicked=c;return e},"~N,~N,~N,JU.BS,~B");j(d,"checkObjectDragged",function(a,b,c,e){if(!this.isPickingMode())return!1;if(-2147483648==a)return a=this.findNearestLabel(c,e),0<=a?(this.lastPicked=this.pickedAtom=a,this.vwr.acm.setDragAtomIndex(a),this.pickedX=c,this.pickedY=e,this.pickedOffset=null==this.offsets||this.pickedAtom>=this.offsets.length?
JV.JC.LABEL_DEFAULT_OFFSET:this.offsets[this.pickedAtom],!0):!1;2147483647==a&&(this.pickedAtom=-1);if(0>this.pickedAtom)return!1;this.move2D(this.pickedAtom,c,e);return!0},"~N,~N,~N,~N,~N,JU.BS");f(d,"findNearestLabel",function(a,b){if(null==this.labelBoxes)return-1;for(var c=3.4028235E38,e=-1,g=3.4028235E38,h=this.vwr.antialiased?2:1,d=this.ms.at,f,n=this.labelBoxes.entrySet().iterator();n.hasNext()&&((f=n.next())||1);)if(d[f.getKey().intValue()].isVisible(this.vf|9)){var l=f.getValue(),k=(a-l[0])*
h,r=(b-l[1])*h;0>=k||(0>=r||k>=l[2]||r>=l[3]||l[4]>g)||(g=l[4],l=Math.min(Math.abs(k-l[2]/2),Math.abs(r-l[3]/2)),l<=c&&(c=l,e=f.getKey().intValue()))}return e},"~N,~N");f(d,"move2D",function(a,b,c){var e=JV.JC.getXOffset(this.pickedOffset),g=JV.JC.getYOffset(this.pickedOffset),e=e+(b-this.pickedX),g=g-(c-this.pickedY);b=JV.JC.getOffset(e,g,!0);this.setOffsets(a,b)},"~N,~N,~N");f(d,"getColix2",function(a,b,c){c?a=null==this.bgcolixes||a>=this.bgcolixes.length?0:this.bgcolixes[a]:(a=null==this.colixes||
a>=this.colixes.length?0:this.colixes[a],a=JU.C.getColixInherited(a,b.colixAtom),JU.C.isColixTranslucent(a)&&(a=JU.C.getColixTranslucent3(a,!1,0)));return a},"~N,JM.Atom,~B");d.nullToken=z(-1,[null])});p("J.shape");t(["J.api.JmolMeasurementClient","J.shape.AtomShape","JU.Lst"],"J.shape.Measures","java.util.Hashtable JU.AU $.BS $.PT $.SB JM.Measurement $.MeasurementData JU.BSUtil $.C $.Escape".split(" "),function(){var d=u(function(){this.strFormat=this.bsSelected=null;this.mustNotBeConnected=this.mustBeConnected=
!1;this.intramolecular=this.radiusData=null;this.measureAllModels=!1;this.measurementCount=0;this.mPending=this.measurements=null;this.colix=0;this.htMin=this.font3d=this.defaultTickInfo=this.tickInfo=null;this.tokAction=0;s(this,arguments)},J.shape,"Measures",J.shape.AtomShape,J.api.JmolMeasurementClient);x(d,function(){this.measurements=new JU.Lst});f(d,"getSelected",function(){return this.bsSelected});j(d,"initModelSet",function(){for(var a=this.measurements.size();0<=--a;){var b=this.measurements.get(a);
null!=b&&(b.ms=this.ms)}});j(d,"initShape",function(){null==this.font3d&&(this.font3d=this.vwr.gdata.getFont3D(18))});j(d,"setSize",function(a){this.mad=a},"~N,JU.BS");j(d,"setProperty",function(a,b,c){var e;if("clearModelIndex"===a)for(var g=0;g<this.measurementCount;g++)this.measurements.get(g).setModelIndex(0);else if("color"===a)this.setColor(JU.C.getColixO(b));else if("font"===a)this.font3d=b;else if("hideAll"===a)this.showHide(b.booleanValue());else if("pending"===a)this.mPending=b,null!=this.mPending&&
1<this.mPending.count&&this.vwr.setStatusMeasuring("measurePending",this.mPending.count,J.shape.Measures.getMessage(this.mPending,!1),this.mPending.value);else{var d;if((d="refresh"===a)||"refreshTrajectories"===a)for(g=this.measurements.size();0<=--g;)null!=(e=this.measurements.get(g))&&(d||e.isTrajectory)&&e.refresh(null);else if("select"===a)0==JU.BSUtil.cardinalityOf(b)?this.bsSelected=null:(this.bsSelected=new JU.BS,this.bsSelected.or(b));else if("selectall"===a)this.bsSelected=JU.BSUtil.newBitSet2(0,
this.measurementCount);else if("setFormats"===a)this.setFormats(b);else if(this.measureAllModels=this.vwr.getBoolean(603979877),"delete"===a)this.deleteO(b),this.setIndices();else{this.bsSelected=null;if("maps"===a)for(g=0;g<b.length;g++)e=b[g].length,2>e||4<e||(d=y(e+1,0),d[0]=e,System.arraycopy(b[g],0,d,1,e),this.toggleOn(d));else if("measure"===a){this.tickInfo=b.tickInfo;if(null!=b.tickInfo&&b.tickInfo.id.equals("default")){this.defaultTickInfo=b.tickInfo;return}if(b.isAll&&2==b.points.size()&&
v(b.points.get(0),"JU.BS"))switch(JM.Measurement.nmrType(this.vwr.getDistanceUnits(b.strFormat))){case 2:b.htMin=this.vwr.getNMRCalculation().getMinDistances(b)}this.tickInfo=b.tickInfo;this.radiusData=b.radiusData;this.htMin=b.htMin;this.mustBeConnected=b.mustBeConnected;this.mustNotBeConnected=b.mustNotBeConnected;this.intramolecular=b.intramolecular;this.strFormat=b.strFormat;if(b.isAll){null!=this.tickInfo&&this.define(b,12291);null!=b.bsSelected&&(this.bsSelected=b.bsSelected);this.define(b,
b.tokAction);this.setIndices();return}g=this.setSingleItem(b.points);g.setFromMD(b,!1);switch(b.tokAction){case 266284:this.doAction(b,b.thisID,266284);break;case 12291:this.defineAll(-2147483648,g,!0,!1,!1);this.setIndices();break;case 1073742335:this.showHideM(g,!1);break;case 1073742334:this.showHideM(g,!0);break;case 1665140738:null!=b.thisID&&this.doAction(b,b.thisID,1665140738);break;case 12290:null==b.thisID?this.deleteM(g):this.deleteO(b.thisID);this.toggle(g);break;case 1275082241:this.bsSelected=
new JU.BS;this.processNextMeasure(b,g);break;case 268438018:this.toggle(g)}return}if("clear"===a)this.clear();else if("deleteAtoms"===a)for(g=this.measurementCount;0<=--g;){d=c.nextSetBit(0);a:for(;0<=d;d=c.nextSetBit(d+1)){e=this.measurements.get(g);b=e.countPlusIndices;for(a=1;a<=b[0];a++)if(b[a]==d){this.deleteI(g);break a}}}else if("deleteModelAtoms"===a){c=b[2][0];d=b[2][1];for(var f=b[2][2],q=d+f,g=this.measurementCount;0<=--g;){e=this.measurements.get(g);b=e.countPlusIndices;for(a=1;a<=b[0];a++){var n=
b[a];if(n>=d){if(n<q){this.deleteI(g);break}b[a]-=f}else if(0>n)if(n=e.getAtom(a),n.mi>c)n.mi--;else if(n.mi==c){this.deleteI(g);break}}}}else"reformatDistances"===a?this.reformatDistances(null==b):"hide"===a?"string"==typeof b?this.doAction(null,b,12294):this.showHideM((new JM.Measurement).setPoints(this.ms,b,null,null),!0):"refresh"===a?this.doAction(b,null,266284):"show"===a?"string"==typeof b?this.doAction(null,b,134222350):this.showHideM((new JM.Measurement).setPoints(this.ms,b,null,null),!1):
"toggle"===a?"string"==typeof b?this.doAction(null,b,268438018):this.toggle((new JM.Measurement).setPoints(this.ms,b,null,null)):"toggleOn"===a&&("string"==typeof b?this.doAction(null,b,1073742335):this.toggleOn(b))}}},"~S,~O,JU.BS");f(d,"setSingleItem",function(a){var b=Array(4),c=y(5,0);c[0]=a.size();for(var e=a.size();0<=--e;){var g=a.get(e);if(v(g,"JU.BS")){g=g.nextSetBit(0);if(0>g)return null;c[e+1]=g}else b[e]=g,c[e+1]=-2-e}return(new JM.Measurement).setPoints(this.ms,c,b,null==this.tickInfo?
this.defaultTickInfo:this.tickInfo)},"JU.Lst");j(d,"getProperty",function(a,b){return"pending".equals(a)?this.mPending:"count".equals(a)?Integer.$valueOf(this.measurementCount):"countPlusIndices".equals(a)?b<this.measurementCount?this.measurements.get(b).countPlusIndices:null:"stringValue".equals(a)?b<this.measurementCount?this.measurements.get(b).getString():null:"pointInfo".equals(a)?this.measurements.get(m(b/10)).getLabel(b%10,!1,!1):"info".equals(a)?this.getAllInfo():"infostring".equals(a)?this.getAllInfoAsString():
"selected".equals(a)?null==this.bsSelected?new JU.BS:JU.BSUtil.copy(this.bsSelected):null},"~S,~N");f(d,"clear",function(){0!=this.measurementCount&&(this.measurementCount=0,this.measurements.clear(),this.mPending=null,this.vwr.setStatusMeasuring("measureDeleted",-1,"all",0))});f(d,"setColor",function(a){null==this.bsColixSet&&(this.bsColixSet=new JU.BS);null==this.bsSelected&&(this.colix=a);for(var b,c=this.measurements.size();0<=--c;)if(null!=(b=this.measurements.get(c))&&(null!=this.bsSelected&&
this.bsSelected.get(c)||null==this.bsSelected&&(0==a||0==b.colix)))b.colix=a,this.bsColixSet.set(c)},"~N");f(d,"setFormats",function(a){null!=a&&0==a.length&&(a=null);var b="default".equals(a);if(b||JM.Measurement.isUnits(a)){b&&(a=null);for(b=this.measurements.size();0<=--b;)if(null==this.bsSelected||this.bsSelected.get(b)){var c=this.measurements.get(b);c.units=a;c.formatMeasurement(null)}}else for(b=this.measurements.size();0<=--b;)(null==this.bsSelected||this.bsSelected.get(b))&&this.measurements.get(b).formatMeasurementAs(a,
null,!1)},"~S");f(d,"showHide",function(a){for(var b=this.measurements.size();0<=--b;)if(null==this.bsSelected||this.bsSelected.get(b))this.measurements.get(b).isHidden=a},"~B");f(d,"showHideM",function(a,b){var c=this.find(a);0<=c&&(this.measurements.get(c).isHidden=b)},"JM.Measurement,~B");f(d,"toggle",function(a){this.htMin=this.radiusData=null;var b=this.find(a),c;0<=b&&!(c=this.measurements.get(b)).isHidden?this.defineAll(b,c,!0,!1,!1):this.defineAll(-1,a,!1,!0,!1);this.setIndices()},"JM.Measurement");
f(d,"toggleOn",function(a){this.htMin=this.radiusData=null;this.bsSelected=new JU.BS;a=(new JM.Measurement).setPoints(this.ms,a,null,this.defaultTickInfo);this.defineAll(-2147483648,a,!1,!0,!0);a=this.find(a);0<=a&&this.bsSelected.set(a);this.setIndices();this.reformatDistances(!1)},"~A");f(d,"deleteM",function(a){this.htMin=this.radiusData=null;a=this.find(a);0<=a&&this.defineAll(a,this.measurements.get(a),!0,!1,!1);this.setIndices()},"JM.Measurement");f(d,"deleteO",function(a){v(a,Integer)?this.deleteI(a.intValue()):
"string"==typeof a?this.doAction(null,a,12291):JU.AU.isAI(a)&&this.defineAll(-2147483648,(new JM.Measurement).setPoints(this.ms,a,null,null),!0,!1,!1)},"~O");f(d,"defineAll",function(a,b,c,e,g){if(this.measureAllModels){if(e&&(this.defineAll(a,b,!0,!1,!1),c))return;a=new JU.Lst;e=b.count;g=this.ms.at;for(var d=1;d<=e;d++){var f=b.getAtomIndex(d);a.addLast(0<=f?this.ms.getAtoms(1094715393,Integer.$valueOf(g[f].getAtomNumber())):b.getAtom(d))}this.define((new JM.MeasurementData).init(null,this.vwr,
a).set(this.tokAction,this.htMin,this.radiusData,b.property,this.strFormat,null,this.tickInfo,this.mustBeConnected,this.mustNotBeConnected,this.intramolecular,!0,0,0,null,NaN,null),c?12291:12290)}else c?(-2147483648==a&&(a=this.find(b)),0<=a&&this.deleteI(a)):this.defineMeasurement(a,b,g)},"~N,JM.Measurement,~B,~B,~B");f(d,"find",function(a){return null==a.thisID?JM.Measurement.find(this.measurements,a):-1},"JM.Measurement");f(d,"setIndices",function(){for(var a=0;a<this.measurementCount;a++)this.measurements.get(a).index=
a});f(d,"define",function(a,b){this.tokAction=b;if(null!=a.bsSelected)for(var c=this.measurementCount;0<=--c;)a.bsSelected.get(c)&&this.processNextMeasure(a,this.measurements.get(c));else 1275082241==b&&(this.bsSelected=new JU.BS),a.define(this,this.ms)},"JM.MeasurementData,~N");j(d,"processNextMeasure",function(a,b){var c=this.find(b);if(1275082241==a.tokAction){if(0>c||!this.isInRange(NaN,b))return;this.bsSelected.set(c)}if(0<=c)12291==this.tokAction?this.isInRange(NaN,b)&&this.deleteI(c):1275082241==
a.tokAction?(c=this.measurements.get(c),c.setFromMD(a,!0),null!=this.strFormat&&null==a.strFormat?c.formatMeasurementAs(this.strFormat,a.units,!0):null!=a.units&&(c.strFormat=null,c.units=a.units.equals("default")?null:a.units,c.formatMeasurement(null))):this.measurements.get(c).isHidden=1073742334==this.tokAction;else if(12290==this.tokAction||268438018==this.tokAction)b.tickInfo=null==this.tickInfo?this.defaultTickInfo:this.tickInfo,this.defineMeasurement(-1,b,!0)},"JM.MeasurementData,JM.Measurement");
f(d,"isInRange",function(a,b){return!(null!=this.htMin&&!b.isMin(this.htMin)||null!=this.radiusData&&!b.isInRange(this.radiusData,a==a?a:b.getMeasurement(null)))},"~N,JM.Measurement");f(d,"defineMeasurement",function(a,b,c){var e=b.getMeasurement(null);this.isInRange(e,b)&&(-2147483648==a&&(a=this.find(b)),0<=a?(this.measurements.get(a).isHidden=!1,c&&this.bsSelected.set(a)):(a=(new JM.Measurement).setM(this.ms,b,e,0==b.colix?this.colix:b.colix,this.strFormat,this.measurementCount),a.$isValid&&(this.measurements.addLast(a),
this.vwr.setStatusMeasuring("measureCompleted",this.measurementCount++,J.shape.Measures.getMessage(a,!1),a.value))))},"~N,JM.Measurement,~B");d.getMessage=f(d,"getMessage",function(a,b){var c=new JU.SB;c.append("[");for(var e=1;e<=a.count;e++)1<e&&c.append(", "),c.append(a.getLabel(e,b,!1));c.append(", ");c.append(a.getString());c.append("]");return c.toString()},"JM.Measurement,~B");f(d,"deleteI",function(a){if(!(a>=this.measurements.size()||0>a)){var b=J.shape.Measures.getMessage(this.measurements.get(a),
!0);this.measurements.removeItemAt(a);this.measurementCount--;this.vwr.setStatusMeasuring("measureDeleted",a,b,0);this.bsSelected=null}},"~N");f(d,"doAction",function(a,b,c){b=b.toUpperCase().$replace("?","*");for(var e=JU.PT.isWild(b),g=this.measurements.size();0<=--g;){var d=this.measurements.get(g);if(null!=d.thisID&&(d.thisID.equalsIgnoreCase(b)||e&&JU.PT.isMatch(d.thisID.toUpperCase(),b,!0,!0)))switch(c){case 266284:d.setFromMD(a,!0);break;case 1665140738:d.mad=a.mad;break;case 12291:d=J.shape.Measures.getMessage(this.measurements.get(g),
!0);this.measurements.removeItemAt(g);this.measurementCount--;this.vwr.setStatusMeasuring("measureDeleted",g,d,0);break;case 134222350:d.isHidden=!1;break;case 12294:d.isHidden=!0;break;case 268438018:d.isHidden=!d.isHidden;break;case 1073742335:d.isHidden=!1}}},"JM.MeasurementData,~S,~N");f(d,"reformatDistances",function(a){for(var b=this.measurementCount;0<=--b;)this.measurements.get(b).reformatDistanceIfSelected(a)},"~B");f(d,"getAllInfo",function(){for(var a=new JU.Lst,b=0;b<this.measurementCount;b++)a.addLast(this.getInfo(b));
return a});f(d,"getAllInfoAsString",function(){for(var a="Measurement Information",b=0;b<this.measurementCount;b++)a+="\n"+this.getInfoAsString(b);return a});f(d,"getInfo",function(a){var b=this.measurements.get(a),c=b.count,e=new java.util.Hashtable;e.put("index",Integer.$valueOf(a));e.put("type",2==c?"distance":3==c?"angle":"dihedral");e.put("strMeasurement",b.getString());e.put("count",Integer.$valueOf(c));e.put("id",""+b.thisID);e.put("value",Float.$valueOf(b.value));e.put("hidden",Boolean.$valueOf(b.isHidden));
e.put("visible",Boolean.$valueOf(b.isVisible));a=b.tickInfo;null!=a&&(e.put("ticks",a.ticks),null!=a.scale&&e.put("tickScale",a.scale),null!=a.tickLabelFormats&&e.put("tickLabelFormats",a.tickLabelFormats),Float.isNaN(a.first)||e.put("tickStart",Float.$valueOf(a.first)));a=new JU.Lst;for(var g=this.ms.at,d=1;d<=c;d++){var f=new java.util.Hashtable,q=b.getAtomIndex(d);f.put("_ipt",Integer.$valueOf(q));f.put("coord",JU.Escape.eP(b.getAtom(d)));f.put("atomno",Integer.$valueOf(0>q?-1:g[q].getAtomNumber()));
f.put("info",0>q?"<point>":g[q].getInfo());a.addLast(f)}e.put("atoms",a);return e},"~N");f(d,"getInfoAsString",function(a){return this.measurements.get(a).getInfoAsString(null)},"~N");f(d,"setVisibilityInfo",function(){var a=this.vwr.getVisibleFramesBitSet(),b=this.measurementCount;a:for(;0<=--b;){var c=this.measurements.get(b);c.isVisible=!1;if(!(0==this.mad||c.isHidden)){for(var e=c.count;0<e;e--){var g=c.getAtomIndex(e);if(0<=g){if(!this.ms.at[g].isClickable())continue a}else if(g=c.getAtom(e).mi,
0<=g&&!a.get(g))continue a}c.isVisible=!0}}})});p("J.shape");t(["J.shape.TextShape"],"J.shape.Echo",["java.util.Hashtable","JU.Lst","$.PT","JM.Text","JU.C"],function(){var d=u(function(){this.scaleObject=null;s(this,arguments)},J.shape,"Echo",J.shape.TextShape);j(d,"initShape",function(){this.setProperty("target","top",null)});j(d,"setProperty",function(a,b,c){if("thisID"===a)null==b?this.thisID=this.currentObject=null:(c=b,"%SCALE"===c?(this.currentObject=this.scaleObject,this.thisID=c):(this.currentObject=
this.objects.get(c),null==this.currentObject&&JU.PT.isWild(c)&&(this.thisID=c.toUpperCase())));else if("%SCALE"===a)this.currentObject=this.scaleObject=b,this.thisID="%SCALE";else if(("color"===a||"font"===a)&&null!=this.scaleObject&&this.currentObject===this.scaleObject){var e=this.currentFont,g=this.currentColor;this.setPropTS(a,b,c);this.currentFont=e;this.currentColor=g}else if("off"===a&&this.currentObject===this.scaleObject)this.currentObject=this.scaleObject=null;else if("text"===a&&b.startsWith("%SCALE"))this.thisID=
"%SCALE",this.setPropTS("text",b,null),this.scaleObject=this.currentObject,null!=this.scaleObject&&this.objects.get(this.scaleObject.target)===this.scaleObject&&this.setPropTS("delete",this.scaleObject,null),this.currentObject=this.scaleObject;else{if("target"===a){if("%SCALE".equals(b)&&(this.currentObject=this.scaleObject,this.thisID="%SCALE",null!=this.currentObject))return;c=b.intern().toLowerCase();if("none"!==c&&"all"!==c){this.isAll=!1;b="%SCALE"===this.thisID?this.scaleObject:this.objects.get(c);
null==b&&(b=3,a=4,"top"===c?(b=0,a=8):"middle"===c?(b=2,a=8):"bottom"===c?b=1:"error"===c&&(b=0),b=JM.Text.newEcho(this.vwr,this.vwr.gdata.getFont3DFS("Serif",20),c,10,b,a,0),b.adjustForWindow=!0,"%SCALE"===this.thisID?this.scaleObject=b:this.objects.put(c,b),null!=this.currentFont&&b.setFont(this.currentFont,!0),null!=this.currentColor&&(b.colix=JU.C.getColixO(this.currentColor)),null!=this.currentBgColor&&(b.bgcolix=JU.C.getColixO(this.currentBgColor)),0!=this.currentTranslucentLevel&&b.setTranslucent(this.currentTranslucentLevel,
!1),0!=this.currentBgTranslucentLevel&&b.setTranslucent(this.currentBgTranslucentLevel,!0));this.currentObject=b;"%SCALE"!==this.thisID&&(this.thisID=null);return}}if("scalereference"===a)null!=this.currentObject&&(b=b.floatValue(),this.currentObject.setScalePixelsPerMicron(0==b?0:1E4/b));else if("point"===a)null!=this.currentObject&&(e=this.currentObject,e.pointerPt=null==b?null:b,e.pointer=null==b?0:1);else if("xyz"===a&&(null!=this.currentObject&&this.vwr.getBoolean(603979845))&&(this.currentObject.setScalePixelsPerMicron(1E4*
this.vwr.getScalePixelsPerAngstrom(!1)),this.currentObject.setXYZ(b,!0)),"scale"===a)if(null!=this.currentObject)this.currentObject.setScale(b.floatValue());else{if(this.isAll)for(a=this.objects.values().iterator();a.hasNext()&&((e=a.next())||1);)e.setScale(b.floatValue())}else if("image"===a)if(null!=this.currentObject)this.currentObject.setImage(b);else{if(this.isAll)for(a=this.objects.values().iterator();a.hasNext()&&((e=a.next())||1);)e.setImage(b)}else if("hidden"===a)if(b=b.booleanValue(),null!=
this.currentObject)this.currentObject.hidden=b;else{if(this.isAll||null!=this.thisID)for(a=this.objects.values().iterator();a.hasNext()&&((e=a.next())||1);)if(this.isAll||JU.PT.isMatch(e.target.toUpperCase(),this.thisID,!0,!0))e.hidden=b}else"script"===a?null!=this.currentObject&&this.currentObject.setScript(b):"xpos"===a?null!=this.currentObject&&(this.currentObject.setXYZ(null,!0),this.currentObject.setMovableX(b.intValue())):"ypos"===a?null!=this.currentObject&&(this.currentObject.setXYZ(null,
!0),this.currentObject.setMovableY(b.intValue())):"%xpos"===a?null!=this.currentObject&&(this.currentObject.setXYZ(null,!0),this.currentObject.setMovableXPercent(b.intValue())):"%ypos"===a?null!=this.currentObject&&(this.currentObject.setXYZ(null,!0),this.currentObject.setMovableYPercent(b.intValue())):"%zpos"===a?null!=this.currentObject&&(this.currentObject.setXYZ(null,!0),this.currentObject.setMovableZPercent(b.intValue())):"xypos"===a?null!=this.currentObject&&(this.currentObject.setXYZ(null,
!0),3.4028235E38==b.z?(this.currentObject.setMovableX(k(b.x)),this.currentObject.setMovableY(k(b.y))):(this.currentObject.setMovableXPercent(k(b.x)),this.currentObject.setMovableYPercent(k(b.y)))):"offset"===a?null!=this.currentObject&&(this.currentObject.pymolOffset=b):("align"===a&&null!=this.currentObject&&(this.currentObject.pymolOffset=null),this.setPropTS(a,b,null))}},"~S,~O,JU.BS");j(d,"getPropertyData",function(a,b){if("currentTarget"===a)return null!=this.currentObject&&null!=(b[0]=this.currentObject.target);
if("%SCALE"===a)return b[0]=this.scaleObject,null!=b[0];if("checkID"===a){for(var c=b[0].toUpperCase(),e=JU.PT.isWild(c),g,d=this.objects.values().iterator();d.hasNext()&&((g=d.next())||1);){var f=g.target;if(f.equalsIgnoreCase(c)||e&&JU.PT.isMatch(f.toUpperCase(),c,!0,!0))return b[1]=f,!0}return!1}return this.getPropShape(a,b)},"~S,~A");j(d,"getShapeDetail",function(){for(var a=new java.util.Hashtable,b,c=this.objects.entrySet().iterator();c.hasNext()&&((b=c.next())||1);){var e=new java.util.Hashtable,
g=b.getValue(),d=b.getKey();e.put("boxXY",g.boxXY);null!=g.xyz&&e.put("xyz",g.xyz);var f=g.image;null==f?e.put("text",null==g.text?"":g.text):(e.put("imageFile",g.text),e.put("imageWidth",Integer.$valueOf(this.vwr.apiPlatform.getImageWidth(f))),e.put("imageHeight",Integer.$valueOf(this.vwr.apiPlatform.getImageHeight(f))));a.put(d,e)}b=new JU.Lst;b.addLast(a);return b})});p("J.shape");t(["J.shape.TextShape"],"J.shape.Hover",["JU.AU","JM.Text","JU.C"],function(){var d=u(function(){this.hoverText=null;
this.atomIndex=-1;this.text=this.xy=null;this.labelFormat="%U";this.specialLabel=this.atomFormats=null;s(this,arguments)},J.shape,"Hover",J.shape.TextShape);j(d,"initShape",function(){this.isHover=!0;var a=this.vwr.gdata.getFont3DFSS("SansSerif","Plain",12),b=JU.C.getColixS("#FFFFC3");this.currentObject=this.hoverText=JM.Text.newLabel(this.vwr,a,null,4,b,4,0);this.hoverText.adjustForWindow=!0});j(d,"setProperty",function(a,b,c){if("target"===a)this.atomIndex=null==b?-1:b.intValue();else if("text"===
a)this.text=b,null!=this.text&&0==this.text.length&&(this.text=null);else if("specialLabel"===a)this.specialLabel=b;else if("atomLabel"===a){a=b;null!=a&&0==a.length&&(a=null);b=this.ms.ac;if(null==this.atomFormats||this.atomFormats.length<b)this.atomFormats=Array(b);for(b=c.nextSetBit(0);0<=b;b=c.nextSetBit(b+1))this.atomFormats[b]=a}else"xy"===a?this.xy=b:"label"===a?(this.labelFormat=b,null!=this.labelFormat&&0==this.labelFormat.length&&(this.labelFormat=null)):"deleteModelAtoms"===a?(null!=this.atomFormats&&
(this.atomFormats=JU.AU.deleteElements(this.atomFormats,b[2][1],b[2][2])),this.atomIndex=-1):this.setPropTS(a,b,null)},"~S,~O,JU.BS")});p("J.render");t(null,"J.render.TextRenderer",["JM.Text"],function(){var d=C(J.render,"TextRenderer",null);d.render=f(d,"render",function(a,b,c,e,g,d,f,q,n,l,m){if(null==b||null==b.image&&!b.doFormatText&&null==b.lines)return!1;var r=0!=(m&64),j=0!=(m&1);m=0!=(m&4);var p=c.setC(b.colix);if(!p&&null==b.image&&(0==b.bgcolix||!c.setC(b.bgcolix)))return!1;null!=a&&4==
b.valign&&J.render.TextRenderer.calcBarPixelsXYZ(a,b,q,!1);b.setPosition(e,g,r,d);a=null!=a&&4==b.valign?J.render.TextRenderer.calcBarPixelsXYZ(a,b,q,!1):b.barPixels;if(null==b.image){if(0!=b.bgcolix&&(c.setC(b.bgcolix)&&J.render.TextRenderer.showBox(c,b.colix,k(b.boxX)-(0==a?0:a+4),k(b.boxY)+2*b.boxYoff2,b.z+2,b.zSlab,k(b.boxWidth)+a,k(b.boxHeight),b.fontScale,!b.isEcho),!p))return!1;for(e=0;e<b.lines.length;e++)b.setXYA(f,e),null!=b.xyz&&(f[1]+=2),c.drawString(b.lines[e],b.font,k(f[0]),k(f[1]),
b.z,b.zSlab,b.bgcolix);0<b.barPixels&&J.render.TextRenderer.renderScale(c,b,f,a,m)}else c.drawImage(b.image,k(b.boxX),k(b.boxY),b.z,b.zSlab,b.bgcolix,k(b.boxWidth),k(b.boxHeight));if(!j)return!0;J.render.TextRenderer.drawLineXYZ(c,b.atomX,b.atomY,b.atomZ,b.boxX,b.boxY,b.zSlab,b.boxWidth,b.boxHeight,n,l*(m?2:1));return!0},"JV.TransformManager,JM.Text,J.api.JmolRendererInterface,~N,~N,~A,~A,JU.P3i,~N,~N,~N");d.calcBarPixelsXYZ=f(d,"calcBarPixelsXYZ",function(a,b,c,e){var g=b.barPixels;null!=b.xyz&&
(a.transformPtScr(b.xyz,c),e&&b.setXYZs(c.x,c.y,c.z,c.z),0<g&&a.perspectiveDepth&&(a=a.unscaleToScreen(c.z,g),g=b.barPixelsXYZ=k(g*b.barDistance/a)));return g},"JV.TransformManager,JM.Text,JU.P3i,~B");d.renderScale=f(d,"renderScale",function(a,b,c,e,g){var d=b.z,f=null==b.xyz?0:2;g=g?2:1;var q=f+k(c[0])-e-1-2*g,n=f+k(c[0])-1-2*g,f=m(b.lineHeight/2);c=k(c[1])-1;a.fillTextRect(q,c-m(f/2)-g,d,b.zSlab,n-q,2*g);a.fillTextRect(q,c-m(2*f/2),d,b.zSlab,2*g,m(2*f/2));a.fillTextRect(n,c-m(2*f/2),d,b.zSlab,2*
g,m(2*f/2));for(n=1;10>n;n++){var l=q+m(n*e/10),j=5==n?f:m(f/2);a.fillTextRect(l,c-j,d,b.zSlab,2*g,j)}},"J.api.JmolRendererInterface,JM.Text,~A,~N,~B");d.drawLineXYZ=f(d,"drawLineXYZ",function(a,b,c,e,d,f,m,q,n,l,j){var r=d-b,p=f-c;if(!(0>=r&&-r<=q&&0>=p&&-p<=n)){var t=NaN;d+=0<p||p<-n?r>q/2?0:r<3*-q/2?q:t=q/2:0<r?0:q;q=!Float.isNaN(t);f+=q&&0<p?0:q&&p<-n?n:n/2;1<j?a.fillCylinderXYZ(l,l,2,j,b,c,e,k(d),k(f),m):(a.setC(l),a.drawLineXYZ(b,c,e,k(d),k(f),m))}},"J.api.JmolRendererInterface,~N,~N,~N,~N,~N,~N,~N,~N,~N,~N");
d.renderSimpleLabel=f(d,"renderSimpleLabel",function(a,b,c,e,d,f,m,q,n,l,j,r,p,t,s){var u=b.stringWidth(c)+8;r=j+r+8;var v=k(f[0]),w=k(f[1]),x=0!=(s&1),y=0!=(s&4);JM.Text.setBoxXY(u,r,n,l,f,0!=(s&64));s=f[0];f=f[1];0!=d&&a.setC(d)?J.render.TextRenderer.showBox(a,e,k(s),k(f),m,q,k(u),k(r),1,!0):a.setC(e);a.drawString(c,b,k(s+4),k(f+4+j),m-1,q,d);if(x&&(0!=n||0!=l))J.render.TextRenderer.drawLineXYZ(a,v,w,q,s,f,q,u,r,p,t*(y?2:1))},"J.api.JmolRendererInterface,JU.Font,~S,~N,~N,~A,~N,~N,~N,~N,~N,~N,~N,~N,~N");
d.showBox=f(d,"showBox",function(a,b,c,e,d,f,m,q,n,l){a.fillTextRect(c,e,d,f,m,q);a.setC(b);l&&(2<=n?a.drawRect(c+3,e+3,d-1,f,m-6,q-6):a.drawRect(c+1,e+1,d-1,f,m-2,q-2))},"J.api.JmolRendererInterface,~N,~N,~N,~N,~N,~N,~N,~N,~B")});p("J.render");t(["J.render.FontLineShapeRenderer","JU.P3","$.P3i"],"J.render.LabelsRenderer",["JM.Text","J.render.TextRenderer","JU.Font","JV.JC"],function(){var d=u(function(){this.minZ=null;this.sppm=this.descent=this.ascent=0;this.screen=this.xy=null;this.fidPrevious=
0;this.pTemp=null;this.fid=this.labelColix=this.bgcolix=0;this.atomPt=this.atom=null;this.pointer=this.textAlign=this.offset=this.doPointer=0;this.zSlab=-2147483648;this.zBox=0;this.boxXY=null;this.mode=this.scalePixelsPerMicron=0;s(this,arguments)},J.render,"LabelsRenderer",J.render.FontLineShapeRenderer);x(d,function(){this.minZ=y(1,0);this.xy=w(3,0);this.screen=new JU.P3i;this.pTemp=new JU.P3});j(d,"render",function(){this.fidPrevious=0;var a=this.shape,b=a.strings,c=a.fids,e=a.offsets;if(null==
b)return!1;var d=this.ms.at,f=this.vwr.cm.colixBackgroundContrast,j=this.vwr.getBackgroundArgb();this.sppm=this.vwr.getScalePixelsPerAngstrom(!0);this.scalePixelsPerMicron=this.vwr.getBoolean(603979845)?1E4*this.sppm:0;this.imageFontScaling=this.vwr.imageFontScaling;var q=-1;this.minZ[0]=2147483647;for(var n=this.g3d.isAntialiased(),l=b.length;0<=--l;)if(this.atomPt=this.atom=d[l],this.isVisibleForMe(this.atom)){var k=b[l];if(!(null==k||0==k.length||null!=a.mads&&0>a.mads[l])){this.labelColix=a.getColix2(l,
this.atom,!1);this.bgcolix=a.getColix2(l,this.atom,!0);0==this.bgcolix&&this.vwr.gdata.getColorArgbOrGray(this.labelColix)==j&&(this.labelColix=f);this.fid=null==c||l>=c.length||0==c[l]?a.zeroFontId:c[l];this.offset=null==e||l>=e.length?0:e[l];var r=0!=(this.offset&32),p=0!=(this.offset&16);this.textAlign=JV.JC.getAlignment(this.offset);this.pointer=JV.JC.getPointer(this.offset);this.doPointer=this.pointer&1;this.mode=this.doPointer|this.offset&64|(n?4:0);this.zSlab=this.atom.sZ-m(this.atom.sD/2)-
3;1>this.zSlab&&(this.zSlab=1);this.zBox=this.zSlab;p?(r=this.atom.group,p=r.groupIndex,p!=q&&(r.getMinZ(d,this.minZ),q=p),this.zBox=this.minZ[0]):r&&(this.zBox=1);1>this.zBox&&(this.zBox=1);r=a.getLabel(l);this.boxXY=!this.isExport||this.vwr.creatingImage?a.getBox(l):w(5,0);null==this.boxXY&&a.putBox(l,this.boxXY=w(5,0));r=this.renderLabelOrMeasure(r,k);null!=r&&a.putLabel(l,r);n&&(this.boxXY[0]/=2,this.boxXY[1]/=2);this.boxXY[4]=this.zBox}}return!1});f(d,"renderLabelOrMeasure",function(a,b){var c=
!1,e=0!=(this.pointer&2)&&0!=this.bgcolix?this.bgcolix:this.labelColix;if(null!=a)null==a.font&&a.setFontFromFid(this.fid),a.atomX=this.atomPt.sX,a.atomY=this.atomPt.sY,a.atomZ=this.zSlab,null==a.pymolOffset?(a.setXYZs(this.atomPt.sX,this.atomPt.sY,this.zBox,this.zSlab),a.colix=this.labelColix,a.bgcolix=this.bgcolix):a.getPymolScreenOffset(this.atomPt,this.screen,this.zSlab,this.pTemp,this.sppm);else{c=4==this.textAlign||0==this.textAlign;if(this.fid!=this.fidPrevious||0==this.ascent)this.vwr.gdata.setFont(JU.Font.getFont3D(this.fid)),
this.fidPrevious=this.fid,this.font3d=this.vwr.gdata.getFont3DCurrent(),c&&(this.ascent=this.font3d.getAscent(),this.descent=this.font3d.getDescent());if(c&&1==this.imageFontScaling&&0==this.scalePixelsPerMicron&&0>b.indexOf("|")&&0>b.indexOf("\n")&&0>b.indexOf("<su")&&0>b.indexOf("<co"))return this.boxXY[0]=this.atomPt.sX,this.boxXY[1]=this.atomPt.sY,J.render.TextRenderer.renderSimpleLabel(this.g3d,this.font3d,b,this.labelColix,this.bgcolix,this.boxXY,this.zBox,this.zSlab,JV.JC.getXOffset(this.offset),
JV.JC.getYOffset(this.offset),this.ascent,this.descent,e,0==this.doPointer?0:this.vwr.getInt(553648147),this.mode),null;a=JM.Text.newLabel(this.vwr,this.font3d,b,this.labelColix,this.bgcolix,this.textAlign,0);a.atomX=this.atomPt.sX;a.atomY=this.atomPt.sY;a.atomZ=this.zSlab;a.setXYZs(this.atomPt.sX,this.atomPt.sY,this.zBox,this.zSlab);c=!0}null==a.pymolOffset&&(null==a.font&&a.setFontFromFid(this.font3d.fid),a.setOffset(this.offset),0!=this.textAlign&&a.setAlignment(this.textAlign));a.pointer=this.pointer;
J.render.TextRenderer.render(null,a,this.g3d,this.scalePixelsPerMicron,this.imageFontScaling,this.boxXY,this.xy,null,e,0==this.doPointer?0:this.vwr.getInt(553648147),this.mode);return c?a:null},"JM.Text,~S")});p("J.render");t(["J.render.LabelsRenderer"],"J.render.MeasuresRenderer","java.util.Hashtable JU.A4 $.M3 $.Measure $.P3 J.render.FontLineShapeRenderer JU.Point3fi".split(" "),function(){var d=u(function(){this.modulating=this.doJustify=!1;this.mad0=0;this.p=this.m=this.mpts=null;this.count=0;
this.matrixT=this.aaT=null;s(this,arguments)},J.render,"MeasuresRenderer",J.render.LabelsRenderer);j(d,"initRenderer",function(){this.mpts=new java.util.Hashtable;this.p=Array(4)});j(d,"render",function(){if(!this.g3d.checkTranslucent(!1))return!1;null==this.atomPt&&(this.atomPt=new JU.Point3fi);var a=this.shape;if(a.ms!==this.ms)return System.out.println("!measure wrong modelset!"),a.clear(),!1;this.doJustify=this.vwr.getBoolean(603979870);this.modulating=null!=this.ms.bsModulated;this.imageFontScaling=
this.vwr.imageFontScaling;this.mad0=a.mad;this.font3d=this.vwr.gdata.getFont3DScaled(a.font3d,this.imageFontScaling);this.m=a.mPending;!this.isExport&&(null!=this.m&&0!=(this.count=this.m.count))&&this.renderPendingMeasurement();if(!this.vwr.getBoolean(603979926))return!1;var b=this.vwr.getBoolean(603979878);a.setVisibilityInfo();for(var c=a.measurementCount;0<=--c;)if(this.m=a.measurements.get(c),this.m.isVisible&&this.m.$isValid&&!(1==(this.count=this.m.count)&&-2147483648==this.m.traceX))this.getPoints(),
this.colix=this.m.colix,0==this.colix&&(this.colix=a.colix),0==this.colix&&(this.colix=this.vwr.cm.colixBackgroundContrast),this.labelColix=this.m.labelColix,0==this.labelColix?this.labelColix=this.vwr.cm.colixBackgroundContrast:-1==this.labelColix&&(this.labelColix=this.colix),this.g3d.setC(this.colix),this.colixA=this.colixB=this.colix,this.mode=this.g3d.isAntialiased()?4:0,this.renderMeasurement(b);return!1});f(d,"getPoints",function(){for(var a=this.count;0<=--a;){var b=this.m.getAtomIndex(a+
1),b=0<=b&&this.modulating?this.getModAtom(b):this.m.getAtom(a+1);0>b.sD&&(this.tm.transformPtScr(b,this.pt0i),b.sX=this.pt0i.x,b.sY=this.pt0i.y,b.sZ=this.pt0i.z);this.p[a]=b}this.modulating&&this.m.refresh(this.p)});f(d,"getModAtom",function(a){var b=Integer.$valueOf(a),c=this.mpts.get(b);null!=c&&(b=null);var e=this.ms.getModulation(a);null==e?c=this.ms.at[a]:(null==c&&(c=new JU.Point3fi),c.setT(this.ms.at[a]),this.vwr.tm.vibrationOn&&this.vwr.tm.getVibrationPoint(e,c,NaN),c.sD=-1);null!=b&&this.mpts.put(b,
c);return c},"~N");f(d,"renderMeasurement",function(a){a=a?this.m.getString():null;null!=a&&(0==a.length?a=null:null!=this.m.text&&(this.m.text.setText(a),this.m.text.colix=this.labelColix,this.m.text.setFontScale(this.imageFontScaling)));0==this.m.mad?(this.dotsOrDashes=!1,this.mad=this.mad0):(this.mad=this.m.mad,this.dotsOrDashes=!0,this.dashDots=0>this.mad?null:J.render.FontLineShapeRenderer.ndots);switch(this.count){case 1:this.drawLine(this.p[0].sX,this.p[0].sY,this.p[0].sZ,this.m.traceX,this.m.traceY,
this.p[0].sZ,this.mad);break;case 2:this.renderDistance(a,this.p[0],this.p[1]);break;case 3:this.renderAngle(a,this.p[0],this.p[1],this.p[2]);break;case 4:this.renderTorsion(a,this.p[0],this.p[1],this.p[2],this.p[3])}this.p[0]=this.p[1]=this.p[2]=this.p[3]=null},"~B");f(d,"renderDistance",function(a,b,c){if(null!=(this.tickInfo=this.m.tickInfo))this.drawLine(b.sX,b.sY,b.sZ,c.sX,c.sY,c.sZ,this.mad),this.tickA=b,this.tickB=c,null==this.tickAs&&(this.tickAs=new JU.P3,this.tickBs=new JU.P3),this.tickAs.set(b.sX,
b.sY,b.sZ),this.tickBs.set(c.sX,c.sY,c.sZ),this.drawTicks(this.mad,null!=a);else{var e=b.sZ-b.sD-10,d=c.sZ-c.sD-10,f=this.drawLine(b.sX,b.sY,e,c.sX,c.sY,d,this.mad);if(null!=a){0<this.mad&&(f<<=1);e=this.m.inFront?Math.min(e,d)-10:m((e+d)/2);1>e&&(e=1);var d=m((b.sX+c.sX)/2),k=m((b.sY+c.sY)/2);null==this.m.text?(this.g3d.setC(this.labelColix),this.drawString(d,k,e,f,this.doJustify&&0<(d-b.sX)*(k-b.sY),!1,!0,this.doJustify?0:2147483647,a)):(this.atomPt.ave(b,c),this.atomPt.sX=m((b.sX+c.sX)/2),this.atomPt.sY=
m((b.sY+c.sY)/2),this.renderLabelOrMeasure(this.m.text,a))}}},"~S,JU.Point3fi,JU.Point3fi");f(d,"renderAngle",function(a,b,c,e){var d=c.sD+10,f=b.sZ-b.sD-10,k=c.sZ-d,j=e.sZ-e.sD-10;b=this.drawLine(b.sX,b.sY,f,c.sX,c.sY,k,this.mad);b+=this.drawLine(c.sX,c.sY,k,e.sX,e.sY,j,this.mad);if(null!=a)if(b=m((b+1)/2),175<this.m.value)null==this.m.text?(d=m(Math.floor(5*this.imageFontScaling)),this.g3d.setC(this.labelColix),this.drawString(c.sX+d,c.sY-d,k,b,!1,!1,!1,this.doJustify?0:2147483647,a)):(this.atomPt.setT(c),
this.renderLabelOrMeasure(this.m.text,a));else{this.m.isTainted()&&(e=JU.Measure.computeAngle(this.p[0],this.p[1],this.p[2],this.vectorT2,this.vectorT3,!1),this.vectorT.cross(this.vectorT2,this.vectorT3),this.m.renderAxis=JU.A4.new4(this.vectorT.x,this.vectorT.y,this.vectorT.z,e),this.vectorT2.normalize(),this.vectorT2.scale(0.5),this.m.renderArc=JU.P3.newP(this.vectorT2));null==this.aaT&&(this.aaT=new JU.A4,this.matrixT=new JU.M3);var n=m(Math.floor(64*(this.m.renderAxis.angle/6.283185307179586)));
e=this.m.renderAxis.angle/n;this.aaT.setAA(this.m.renderAxis);for(var l=m(n/2);0<=--n;){this.aaT.angle=n*e;this.pointT.setT(this.m.renderArc);this.matrixT.setAA(this.aaT).rotate(this.pointT);this.pointT.add(c);var p=this.tm.transformPt(this.pointT),r=p.z-d;0>r&&(r=0);this.g3d.drawPixel(p.x,p.y,r);n==l&&(this.pointT.setT(this.m.renderArc),this.pointT.scale(1.1),this.matrixT.rotate(this.pointT),this.pointT.add(c),this.tm.transformPt(this.pointT),r=this.m.inFront?Math.min(Math.min(f,k),j):p.z-d,1>r&&
(r=1),null==this.m.text?(this.g3d.setC(this.labelColix),this.drawString(p.x,p.y,r,b,p.x<c.sX,!1,!1,this.doJustify?c.sY:2147483647,a)):(this.atomPt.setT(this.pointT),this.renderLabelOrMeasure(this.m.text,a)))}}},"~S,JU.Point3fi,JU.Point3fi,JU.Point3fi");f(d,"renderTorsion",function(a,b,c,e,d){var f=b.sZ-b.sD-10,k=c.sZ-c.sD-10,j=e.sZ-e.sD-10,n=d.sZ-d.sD-10,l=this.drawLine(b.sX,b.sY,f,c.sX,c.sY,k,this.mad),l=l+this.drawLine(c.sX,c.sY,k,e.sX,e.sY,j,this.mad),l=l+this.drawLine(e.sX,e.sY,j,d.sX,d.sY,n,
this.mad);null!=a&&(f=this.m.inFront?Math.min(Math.min(Math.min(f,k),j),n):m((f+k+j+n)/4),1>f&&(f=1),l/=3,null==this.m.text?(this.g3d.setC(this.labelColix),this.drawString(m((b.sX+c.sX+e.sX+d.sX)/4),m((b.sY+c.sY+e.sY+d.sY)/4),f,l,!1,!1,!1,this.doJustify?0:2147483647,a)):(this.atomPt.add2(b,c),this.atomPt.add(e),this.atomPt.add(d),this.atomPt.scale(0.25),this.renderLabelOrMeasure(this.m.text,a)))},"~S,JU.Point3fi,JU.Point3fi,JU.Point3fi,JU.Point3fi");f(d,"renderPendingMeasurement",function(){try{this.getPoints()}catch(a){if(B(a,
Exception)){this.shape.mPending=null;return}throw a;}var b=-2147483648==this.m.traceX;this.g3d.setC(this.labelColix=b?this.vwr.cm.colixRubberband:2==this.count?20:23);if(this.m.haveTarget)this.renderMeasurement(b);else{b=this.p[this.count-1];1<this.count&&this.renderMeasurement(!1);var c=b.sZ-b.sD-10,e=this.vwr.getCursorX(),d=this.vwr.getCursorY();this.g3d.isAntialiased()&&(e<<=1,d<<=1);this.drawLine(b.sX,b.sY,c,e,d,c,this.mad)}});j(d,"drawLine",function(a,b,c,e,d,f,j){j=k(20<=j&&1!=this.exportType?
this.vwr.tm.scaleToScreen(m((c+f)/2),j):j);if(this.dotsOrDashes&&(null==this.dashDots||this.dashDots===J.render.FontLineShapeRenderer.ndots))this.width=j;return this.drawLine2(this.g3d,a,b,c,e,d,f,j)},"~N,~N,~N,~N,~N,~N,~N")});p("J.render");t(["J.render.LabelsRenderer"],"J.render.EchoRenderer",["J.render.TextRenderer","JU.C"],function(){var d=u(function(){this.haveTranslucent=!1;s(this,arguments)},J.render,"EchoRenderer",J.render.LabelsRenderer);j(d,"render",function(){if(this.vwr.isPreviewOnly)return!1;
var a=this.shape;this.sppm=this.vwr.getBoolean(603979845)?1E4*this.vwr.getScalePixelsPerAngstrom(!0):0;this.imageFontScaling=this.vwr.imageFontScaling;this.haveTranslucent=!1;for(var b=this.g3d.isAntialiased()?4:0,c,d=a.objects.values().iterator();d.hasNext()&&((c=d.next())||1);)this.renderEcho(c,b);null!=a.scaleObject&&this.renderEcho(a.scaleObject,b);this.isExport||(a=this.vwr.getFrameTitle(),null!=a&&0<a.length&&this.g3d.setC(this.vwr.cm.colixBackgroundContrast)&&this.renderFrameTitle(this.vwr.formatText(a)));
return this.haveTranslucent});f(d,"renderEcho",function(a,b){if(a.visible&&!a.hidden&&(!v(a.pointerPt,"JM.Atom")||a.pointerPt.checkVisible())){4==a.valign&&J.render.TextRenderer.calcBarPixelsXYZ(this.tm,a,this.pt0i,!0);if(null!=a.pymolOffset)a.getPymolScreenOffset(a.xyz,this.pt0i,this.zSlab,this.pTemp,this.sppm);else if(2147483647!=a.movableZPercent){var c=this.vwr.tm.zValueFromPercent(a.movableZPercent%1E3);4==a.valign&&1E3<=Math.abs(a.movableZPercent)&&(c=this.pt0i.z-this.vwr.tm.zValueFromPercent(0)+
c);a.setZs(c,c)}null==a.pointerPt?a.pointer=0:(a.pointer=1,this.tm.transformPtScr(a.pointerPt,this.pt0i),a.atomX=this.pt0i.x,a.atomY=this.pt0i.y,a.atomZ=this.pt0i.z,-2147483648==a.zSlab&&(a.zSlab=1));J.render.TextRenderer.render(this.tm,a,this.g3d,this.sppm,this.imageFontScaling,null,this.xy,this.pt2i,0,0,b)&&(1==a.valign&&12==a.align)&&(this.vwr.noFrankEcho=!1);if(JU.C.renderPass2(a.bgcolix)||JU.C.renderPass2(a.colix))this.haveTranslucent=!0}},"JM.Text,~N");f(d,"renderFrameTitle",function(a){this.vwr.gdata.setFontBold("arial",
k(24*this.imageFontScaling));var b=m(Math.floor(this.vwr.getScreenHeight()*(this.g3d.isAntialiased()?2:1)-10*this.imageFontScaling)),c=m(Math.floor(5*this.imageFontScaling));this.g3d.drawStringNoSlab(a,null,c,b,0,0)},"~S")});p("J.render");t(["J.render.ShapeRenderer"],"J.render.HoverRenderer",["JU.P3","J.render.TextRenderer"],function(){var d=u(function(){this.ptTemp=this.tempXY=null;s(this,arguments)},J.render,"HoverRenderer",J.render.ShapeRenderer);x(d,function(){this.tempXY=w(3,0)});j(d,"render",
function(){if(this.tm.isNavigating())return!1;null==this.ptTemp&&(this.ptTemp=new JU.P3);var a=this.shape,b=this.g3d.isAntialiased(),c=a.hoverText,d;if(0<=a.atomIndex){var f=this.ms.at[a.atomIndex];d=null!=a.specialLabel?a.specialLabel:null!=a.atomFormats&&null!=a.atomFormats[a.atomIndex]?this.ms.getLabeler().formatLabel(this.vwr,f,a.atomFormats[a.atomIndex],this.ptTemp):null!=a.labelFormat?this.ms.getLabeler().formatLabel(this.vwr,f,this.fixLabel(f,a.labelFormat),this.ptTemp):null;if(null==d)return!1;
c.setXYZs(f.sX,f.sY,1,-2147483648)}else if(null!=a.text)d=a.text,c.setXYZs(a.xy.x,a.xy.y,1,-2147483648);else return!0;null!=this.vwr&&(d=this.vwr.formatText(d));c.setText(d);J.render.TextRenderer.render(null,c,this.g3d,0,b?2:1,null,this.tempXY,null,0,0,0);return!0});f(d,"fixLabel",function(a,b){return null==b||null==a?null:this.ms.isJmolDataFrameForModel(a.mi)&&b.equals("%U")?"%W":b},"JM.Atom,~S")})})(Clazz,Clazz.getClassName,Clazz.newLongArray,Clazz.doubleToByte,Clazz.doubleToInt,Clazz.doubleToLong,
Clazz.declarePackage,Clazz.instanceOf,Clazz.load,Clazz.instantialize,Clazz.decorateAsClass,Clazz.floatToInt,Clazz.floatToLong,Clazz.makeConstructor,Clazz.defineEnumConstant,Clazz.exceptionOf,Clazz.newIntArray,Clazz.newFloatArray,Clazz.declareType,Clazz.prepareFields,Clazz.superConstructor,Clazz.newByteArray,Clazz.declareInterface,Clazz.newShortArray,Clazz.innerTypeInstance,Clazz.isClassDefined,Clazz.prepareCallback,Clazz.newArray,Clazz.castNullAs,Clazz.floatToShort,Clazz.superCall,Clazz.decorateAsType,
Clazz.newBooleanArray,Clazz.newCharArray,Clazz.implementOf,Clazz.newDoubleArray,Clazz.overrideConstructor,Clazz.clone,Clazz.doubleToShort,Clazz.getInheritedLevel,Clazz.getParamsType,Clazz.isAF,Clazz.isAB,Clazz.isAI,Clazz.isAS,Clazz.isASS,Clazz.isAP,Clazz.isAFloat,Clazz.isAII,Clazz.isAFF,Clazz.isAFFF,Clazz.tryToSearchAndExecute,Clazz.getStackTrace,Clazz.inheritArgs,Clazz.alert,Clazz.defineMethod,Clazz.overrideMethod,Clazz.declareAnonymous,Clazz.cloneFinals);
